	USENET TO E-MAIL GATEWAY

	Release 4.1.8, 24 November 1995.
	by Stanislav Voronyi, Kharkov, Ukraine

	Copyrights (C) Vadim Antonov 1991,
                   (C) Stanislav Voronyi 1992-1995,
                   (C) Pavel Gulchouck 1996-1998

   Новая версия mail-news сервера сделанного на основе mail-news-а написанного
в 1991 году Вадимом Антоновым. В сервере значительно расширен и улучшен сервис,
изменен формат хранения базы данных подписчиков. Сервер состоит из таких частей:

	newsserver - собственно сам сервер, воспринимающий комманды
		   пользователей и ведущий базу даных подписчиков.

	feeder   - программа рассылки статей подписчикам по feed и
		   подготовки списка статей для подписчиков по subscribe.

	lister   - программа рассылки списков статей подписчикам.
		   Кроме того она же рассылает списки новых групп,
		   занесенных в сервер коммандой addgroup утилиты sdba.

        nntpserv - Отдельная утилита, находящяяся в каталоге nntp.
                   Эта утилита по своему назначению аналогична slurp,
                   Но работает по базе данных подписчиков и берёт только
                   те группы, на которые кто-л. подписан. Разные группы
                   можно брать на разных серверах - это задаётся командой
                   sethost утилиты sdba.

	newgroups - Утилита для рассылки списков созданых новых групп.
		   Предполагается периодический запуск этой утилиты из
		   cron-а. 

	sdba     - программа для локального обслуживания базы данных
		   подписчиков. База данных представляет собой двоичный
                   файла с очень сложной внутреней структурой, и вносить
                   в него изменения каким либо другим способом невозможно.

        convert  - программа лежащая в отдельном каталоге и скорее всего
                   она Вам понадобится только один раз при установке сервера.
                   В каталоге convert содержится 3 подкаталога: avg, vak и stas.
                   В каждом из них находится дистрибутив программы convert
                   расчитаный на:
			avg   - mailnews Вадима Антонова
			vak   - nserv-2.7 Вакуленко
			stas  - mn-3.2 Станислава Вороного
                  При конвертировании для mn-3.2 сохраняются все флаги
                  пользователей кроме флага AGING - он для всех включен.
                  Для сервера mailnews и nserv-2.7 сохраняется только
                  режим подписки (subs/feed/rfeed) а флаги устанавливаются
                  по умолчанию.

        newsserv - он находится в каталоге daemon. Это программа которая
                  создаёт очредь заданий к серверу и запускает их по одному,
                  чтобы уменьшить нагрузку на машину.

Программа тестирована под Linux с системой C-news написанной
Geoffrey Collyer and Henry Spencer from University of Toronto.
Если Вы используете новый CNews (т.н. Perfomance Release), определите
соответствующий define препроцессора (см. файл conf.h). Cleanup release
of Cnews с точки зрения сервера ни чем не отличается от Perfomance Release.
Возможно также выполнение программы под SCO XENIX, AT&T UNIX, ISC UNIX,
BSD системы (BSDI, free BSD).

Если Вы будете использовать сервер под ISC UNIX совместно с IDA sendmail
то вместо компиляции с флагом -posix лучше использовать флаг -D_POSIX_SOURCE
при компиляции и опцию -lcposix при сборке сервера.

Перед сборкой желательно посмотреть в файлы conf.h и dbsubs.h дабы
подправить там что-л. для себя. Собирается все коммандой make,
устанавливается по make install. Установку желательно делать из под root-а.
Если каталоге /usr/adm создать файла имена которых задаются макросами
STATFILE и LOGFILE в них будет писаться соответсвенно статистика посылки
статей в телеконференции в формате mailstat и протоколы работы сервера.
Строку с макросом LOGFILE можно закомментировать, тогда сервер будет
скомпилирован без возможности писать проколы. Оба файла должны быть
доступны по записи для сервера. 

Я не стал делать конфигурацию сервера изменяемой поскольку imho 
переконфигурация сервера деяние редкое, и ради него сервер можно и
перекомпилировать. Imho это лучше чем держать в памяти кусок программы,
который скорее всего никогда не понадобится. Вся конфигурация сервера
осуществляется на этапе компиляции установкой нужных define-ов в
файле conf.h.

Если определить макрос MEMMAP в файле dbsubs.h, то программы feeder и 
lister при работе будут читать в память всю базу и пользоваться ею
оттуда, полностью освобождая файл базы. Это существенно ускоряет
работу feeder-а, но требует гораздо больше памяти.
BUG: эта опция обязательно требует наличие ANSI C компилятора, поэтому
в XENIX безполезно пытаться скомпилить сервер с этой опцией, правда я
не знаю, есть ли где еще XENIX :).

Если Вы не хотите, чтобы Вашим сервером не могли пользоваться посторонние
пользователи Вы можете раскоментировать макрос UNKNOWN_DENIED. Но при этом
Вам вручную прийдется заводить пользователей в базе, чтобы они могли начать
работать. Незарегистрированный в базе пользователь доступа к серверу иметь
не будет. Регистрация пользователя делается командой sdba adddomain ....
после чего пользователи этого домена могут подписываться самостоятельно.

Пустые домены, созданые при помощи sdba или образовавшиеся в результате
команды FORGET от последнего пользователя в домене можно посмотреть 
по команде sdba check domain empty. При надобности их можно удалить.
BUG: Сервер позволяет держать пустые домены, если они имеют флаг site.
     Если у вас есть пустой домен site.town.ua и он единственный в
     домене town.ua, то удалять надо весь town.ua - rmdomain site.town.ua
     в этом случае завершится с ошибкой.

Если Вы определите макрос CXPOST, то для коммерческих групп кроспостинг будет
разрешен только в группы разных иерархий. Если этот макрос закоментарить, то
будет действовать только ограничение кросспостинга в некоммерческие группы.

Если значение макроса AGE_TIME > 0 это означает, что включено старение 
подписки. Если пользователь за AGE_TIME дней не пришлет ни одного письма
серверу, он будет автоматически удален из базы при выполнении команды
rebuild утилиты sdba. В случае если Вы собираеетсь использовать эту функцию
имеет смысл организовать переодическое выполнение sdba rebuild при помощи cron.
Если Вы не будете использовать эту возможность удалите описание команды
AGING из файлов помощи.

Если у Вас есть желание немного упростить жизнь пользователям Вы можете
использовать сервер для вызова других серверов. Для этого Вам необходимо
раскоментировать макрос EXT_SERV_PATH и если необходимо изменить его.
В этом случаае пользователи смогут использовать комманды CALL и EXEC.
Формат этих комманд:
CALL server_name
.
.
.
команды сервера
.
.
.
QUIT|END|EXIT
В этом случае будет вызван на исполнение файл EXT_SERV_PATH/server_name с 
параметром -r user_addr, а на stdin ему будет дан файл содержащий
упрощенный заголовок (только From_, From:, Subject:, Message-Id:, Date:)
и тело состоящее из команд находящихся между CALL и QUIT. Вызов EXEC
отличается только тем, что из него не происходит возврата и в тело
передается весь необработанный хвост письма. Если Вы будете использовать
данную возможность перед установкой сервера вставте файлы es.* в соответ-
ствующие файлы help-ов. И не забудте предварительно вставить в них список
серверов доступных к вызову на Вашей машине.

Если Вы раскоментируете макрос EXT_CMDS, и создадите файл с указанным
именем и содержащий строки такого образца:

комманда	path/file p1 p2 ...

то эти комманды также могут быть выполнены. Программа path/file будет
вызвана с параметрами -r user-addr p1 p2 p3..., где p1 p2 p3 - пара-
метры содержащиесе в строке после имени комманды. Весь stdout этой
команды будет отослан в письме-ответе пользователю. Да, и не забудте
описать эти комманды в help-е, чтобы пользователи знали об их наличии.
Как внешние комманды могут использоваться shell скрипты даже если в их
начале нет #!. Если Ваша система поддерживает указание интерпретатора
через #! то можно использовать любые скрипты.

Если среди Ваших абонентов работающих через сервер есть модераторы групп
для которых установлен флаг R (READONLY), откоментируйте макрос 
NEED_MODERATORS в файле conf.h, а в директории files заполните файл
moderators адресами Ваших абонентов-модераторов в формате

адрес_абонента	модерируемая_группа|иерархия

Если среди Вам такая возможность не нужна закоментируйте этот макрос.

Если Вы хотите запретить доступ к серверу доступ для абонентов имеющих
какие-л. нежелательные для Вас имена, занесите эти имена в файл bad.users
в каталоге files. Строки этого файла трактуются как шаблоны в стиле shell.
Так например можно задавать - *@svoloch.town.ua или news@*

Если Вы будете пользоваться еще и демоном, идущим в комплекте, то
его имя необходимо занести в файл /usr/lib/relcom/Services если Вы исполь-
зуете uumail или если у Вас sendmail/smail сделать алиас в aliases файле:
 
newsserv:	|/usr/mnews/bin/newsserv

и это и будет программа на которую абоненты пишут письма. Это не обязательно
должен быть newsserv - его можно переименовать. Если же Вы имеете
достаточно ресурсов, чтобы позволить запускать несколько серверов паралельно
демона Вы можете не использовать. В этом случае программа принимающая и
обрабатывающая запросы newsserver. Демона желательно использовать всегда,
т.к. newsserver локирует файл базы и могут быть неприятные последствия
(сервер может недождаться возможности залокировать базу на запись и
остановить всю очередь заданий).

Программы feeder и lister необходимо вставить в crontab, например так:

15 * * * * /usr/mnews/bin/feeder
25 9,13,17 * * * /usr/mnews/bin/lister
0 0 * * 0 /usr/mnews/bin/newgroups

Дополнительно неплохо было бы сделать - поставить в crontab копирование 
базы данных подписчиков на всякий случай, для этого есть shell скрипт
copybase.sh, который предохраняет копию базы от копирования в нее
испорченной базы данных, например:

59 23 * * * /usr/mnews/bin/copybase.sh

По всем вопросам по установке и эксплуатации сервера обращатся к 
Станиславу Вороному (stas@uanet.kharkov.ua).

       С уважением,
	     Станислав Вороный.

